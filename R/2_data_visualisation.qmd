---
title: "Data Visualisation"
format: pdf
editor: visual
---

## Missing data

```{r}
sum(is.na(data_NIRS_raw))
# Aucune données manquante
```

## Data repartition

```{r}
require(ggplot2)
require(cowplot)

#Barplot nu nombre d'observations pour les modalité des variables qualitatives

#Création de la fonction "eq" pour faire les barplots
eq <- function(x) {
  data_NIRS_raw  |> 
    ggplot() + aes(x = x) +
    geom_bar(fill = "darkolivegreen3") + 
    labs(y = "Nombre")+
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(), #Suppression de la grille majeure
          panel.grid.minor = element_blank(), #suppression de la grille mineure
          panel.border = element_blank(), #suppression du cadre
          panel.background = element_blank(), #suppression du fond
          text = element_text(size = 12),#augmentation de la taille des labels
          axis.title.x=element_blank(),#suppression du titre des x
          axis.ticks.x=element_blank())#suppression des x ticks
}

#Barplot des différentes variables qualitatives
plot1 <- eq(data_NIRS_raw$`Growth season`)
plot1 <- plot1 + theme(axis.text.x = element_text(angle = 45, hjust = 1))
plot2 <- eq(data_NIRS_raw$`Growth condition`)
plot3 <- eq(data_NIRS_raw$`N regime`)
plot4 <- eq(data_NIRS_raw$`W regime`)
plot5 <- eq(data_NIRS_raw$`Tissue`)
plot5 <- plot5 + theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Création d'un panneau avec les barplots
#Création d'une première ligne de barplots alignés
top_row <- plot_grid(plot1, plot2, plot3, align = "h", axis = "l", ncol = 3)
#Création d'une seconde ligne de barplots alignés
bottom_row <- plot_grid(plot4, plot5, align = "h", axis = "l", ncol = 3)
#Création du panneau compet contenant les deux lignes de barplots
plot_grid(top_row, bottom_row, ncol = 1)

#Création d'un barplot a part pour la variable "Accession"
plot6 <- eq(data_NIRS_raw$`Accession`)
plot6 <- plot6+ 
  theme(axis.text.x = element_text(angle = 45, hjust = 1), text = element_text(size = 7))
plot6
```

## Correlation between variable

```{r}
# On décide d'approcher la courbe réelle discrétisée via des fonctions splines
library(splines)
snv_x <- t(scale(t(data_NIRS_raw[,-c(1:14)]))) # on recrée une matrice des ondes centrées réduite
# En voulant reprendre les data.frame, déja transformé, j'avais des problèles de classes d'objet... d'ou ce nouveau snv_x

# nombre de splines 
n_splines = 50

B <- bs(wavelength, df = n_splines) # Création des splines
# matplot(wavelength, B, type = "l", col = "blue", lty = 1) # affichage des différentes fonctions

mod <- lm(x ~., data = data.frame(x = snv_x[1,], B)) # modèle linéaire entre la première courbe et les splines

alpha <- coef(mod)[-1]
spl <- B%*% alpha + coef(mod)[1] # création de la nouvelle courbe
plot(wavelength, snv_x[1,], type = "l", col = "blue")
lines(wavelength, spl, col = "red")
```
